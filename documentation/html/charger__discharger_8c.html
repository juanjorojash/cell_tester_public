<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Multichemistry cell charge and discharge system: charger_discharger.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Multichemistry cell charge and discharge system
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">charger_discharger.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Hardware related functions source file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="charger__discharger_8h_source.html">charger_discharger.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a25a40b6614565f755233080a384c35f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a25a40b6614565f755233080a384c35f1">initialize</a> ()</td></tr>
<tr class="memdesc:a25a40b6614565f755233080a384c35f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to initialize all the PIC16F1787 registers.  <a href="#a25a40b6614565f755233080a384c35f1">More...</a><br /></td></tr>
<tr class="separator:a25a40b6614565f755233080a384c35f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c80a804f63cdf1b40bca055d0b2d77d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a0c80a804f63cdf1b40bca055d0b2d77d">control_loop</a> ()</td></tr>
<tr class="memdesc:a0c80a804f63cdf1b40bca055d0b2d77d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calls the PI control loop for current or voltage depending on the value of the <a class="el" href="charger__discharger_8h.html#ad4bb67368b5b95e33bae6d43ef3174a8" title="CC / CV selector. CC:  cmode = 1 . CV:  cmode = 0">cmode</a> variable.  <a href="#a0c80a804f63cdf1b40bca055d0b2d77d">More...</a><br /></td></tr>
<tr class="separator:a0c80a804f63cdf1b40bca055d0b2d77d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0a5face47787c24a8922e3a5b4274ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#ac0a5face47787c24a8922e3a5b4274ee">pid</a> (uint16_t feedback, uint16_t setpoint)</td></tr>
<tr class="memdesc:ac0a5face47787c24a8922e3a5b4274ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function defines the PI controller.  <a href="#ac0a5face47787c24a8922e3a5b4274ee">More...</a><br /></td></tr>
<tr class="separator:ac0a5face47787c24a8922e3a5b4274ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95853552054d1c99e8765eca54abb930"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a95853552054d1c99e8765eca54abb930">set_DC</a> ()</td></tr>
<tr class="memdesc:a95853552054d1c99e8765eca54abb930"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function sets the desired duty cycle of the PWM.  <a href="#a95853552054d1c99e8765eca54abb930">More...</a><br /></td></tr>
<tr class="separator:a95853552054d1c99e8765eca54abb930"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1db67160f1d6e9368e8c07df1c904eb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a1db67160f1d6e9368e8c07df1c904eb4">cc_cv_mode</a> (uint16_t current_voltage, uint16_t reference_voltage, bool CC_mode_status)</td></tr>
<tr class="memdesc:a1db67160f1d6e9368e8c07df1c904eb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function switches between CC and CV mode.  <a href="#a1db67160f1d6e9368e8c07df1c904eb4">More...</a><br /></td></tr>
<tr class="separator:a1db67160f1d6e9368e8c07df1c904eb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb92cf488fc031fa581b9f7d2f90b438"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#acb92cf488fc031fa581b9f7d2f90b438">scaling</a> ()</td></tr>
<tr class="memdesc:acb92cf488fc031fa581b9f7d2f90b438"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes care of scaling the average values to correspond with their real values.  <a href="#acb92cf488fc031fa581b9f7d2f90b438">More...</a><br /></td></tr>
<tr class="separator:acb92cf488fc031fa581b9f7d2f90b438"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76c124e0fe411cb223495b945f9e7b6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a76c124e0fe411cb223495b945f9e7b6d">log_control</a> ()</td></tr>
<tr class="memdesc:a76c124e0fe411cb223495b945f9e7b6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function takes care of calculating the average values printing the log data using the UART.  <a href="#a76c124e0fe411cb223495b945f9e7b6d">More...</a><br /></td></tr>
<tr class="separator:a76c124e0fe411cb223495b945f9e7b6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf70b9e763a525b6113c0349583e7ac0"><td class="memItemLeft" align="right" valign="top"><a id="abf70b9e763a525b6113c0349583e7ac0"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#abf70b9e763a525b6113c0349583e7ac0">read_ADC</a> (uint16_t channel)</td></tr>
<tr class="memdesc:abf70b9e763a525b6113c0349583e7ac0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function read the ADC and store the data in the coresponding variable. <br /></td></tr>
<tr class="separator:abf70b9e763a525b6113c0349583e7ac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4774aa6e41b08b4ff32010c008fa3a99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a4774aa6e41b08b4ff32010c008fa3a99">timing</a> ()</td></tr>
<tr class="memdesc:a4774aa6e41b08b4ff32010c008fa3a99"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function control the timing.  <a href="#a4774aa6e41b08b4ff32010c008fa3a99">More...</a><br /></td></tr>
<tr class="separator:a4774aa6e41b08b4ff32010c008fa3a99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f1efdf53830030b8d4b67843aad1870"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a6f1efdf53830030b8d4b67843aad1870">calculate_avg</a> ()</td></tr>
<tr class="memdesc:a6f1efdf53830030b8d4b67843aad1870"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calculate the averages.  <a href="#a6f1efdf53830030b8d4b67843aad1870">More...</a><br /></td></tr>
<tr class="separator:a6f1efdf53830030b8d4b67843aad1870"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa547d1d7074b73a55b85640b558923b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#aaa547d1d7074b73a55b85640b558923b">interrupt_enable</a> ()</td></tr>
<tr class="memdesc:aaa547d1d7074b73a55b85640b558923b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function activate the UART reception interruption.  <a href="#aaa547d1d7074b73a55b85640b558923b">More...</a><br /></td></tr>
<tr class="separator:aaa547d1d7074b73a55b85640b558923b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf92d1a230db7234bdf5119716a0cf5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#abf92d1a230db7234bdf5119716a0cf5f">UART_send_char</a> (char bt)</td></tr>
<tr class="memdesc:abf92d1a230db7234bdf5119716a0cf5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function send one byte of data to UART.  <a href="#abf92d1a230db7234bdf5119716a0cf5f">More...</a><br /></td></tr>
<tr class="separator:abf92d1a230db7234bdf5119716a0cf5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29ad5228bebf7b764c5ee79400b208ec"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a29ad5228bebf7b764c5ee79400b208ec">UART_get_char</a> ()</td></tr>
<tr class="memdesc:a29ad5228bebf7b764c5ee79400b208ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function receive one byte of data from UART.  <a href="#a29ad5228bebf7b764c5ee79400b208ec">More...</a><br /></td></tr>
<tr class="separator:a29ad5228bebf7b764c5ee79400b208ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac27ccd7f2eb1f5e96bb091338acc1e7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#ac27ccd7f2eb1f5e96bb091338acc1e7f">UART_send_string</a> (char *st_pt)</td></tr>
<tr class="memdesc:ac27ccd7f2eb1f5e96bb091338acc1e7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function send a string using UART.  <a href="#ac27ccd7f2eb1f5e96bb091338acc1e7f">More...</a><br /></td></tr>
<tr class="separator:ac27ccd7f2eb1f5e96bb091338acc1e7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92a0c0757e4254434d1526372af3113d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a92a0c0757e4254434d1526372af3113d">display_value_u</a> (uint16_t value)</td></tr>
<tr class="memdesc:a92a0c0757e4254434d1526372af3113d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function convert a number to string and then send it using UART.  <a href="#a92a0c0757e4254434d1526372af3113d">More...</a><br /></td></tr>
<tr class="separator:a92a0c0757e4254434d1526372af3113d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fcc321fc8a8e5fb1c8aeeae5da8daf1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a9fcc321fc8a8e5fb1c8aeeae5da8daf1">display_value_s</a> (int16_t value)</td></tr>
<tr class="memdesc:a9fcc321fc8a8e5fb1c8aeeae5da8daf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function convert a number to string and then send it using UART.  <a href="#a9fcc321fc8a8e5fb1c8aeeae5da8daf1">More...</a><br /></td></tr>
<tr class="separator:a9fcc321fc8a8e5fb1c8aeeae5da8daf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7281e6b87164140f094392ac68ff1d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#ad7281e6b87164140f094392ac68ff1d6">temp_protection</a> ()</td></tr>
<tr class="separator:ad7281e6b87164140f094392ac68ff1d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d26bd6e1261ba0d776c492ad35593f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a1d26bd6e1261ba0d776c492ad35593f4">Cell_ON</a> ()</td></tr>
<tr class="memdesc:a1d26bd6e1261ba0d776c492ad35593f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function activate the desired relay in the switcher board according to the value of <a class="el" href="charger__discharger_8h.html#a2f582152bcd11169abaab8dfb2e0ae2a" title="Cell counter from &#39;1&#39; to &#39;4&#39;. Initialized as &#39;1&#39;.">cell_count</a>.  <a href="#a1d26bd6e1261ba0d776c492ad35593f4">More...</a><br /></td></tr>
<tr class="separator:a1d26bd6e1261ba0d776c492ad35593f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3290085338ff7657c1ff25788d944727"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="charger__discharger_8c.html#a3290085338ff7657c1ff25788d944727">Cell_OFF</a> ()</td></tr>
<tr class="memdesc:a3290085338ff7657c1ff25788d944727"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function deactivate all relays in the switcher board.  <a href="#a3290085338ff7657c1ff25788d944727">More...</a><br /></td></tr>
<tr class="separator:a3290085338ff7657c1ff25788d944727"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hardware related functions source file. </p>
<dl class="section author"><dt>Author</dt><dd>Juan J. Rojas </dd></dl>
<dl class="section date"><dt>Date</dt><dd>7 Aug 2018 </dd></dl>
<dl class="section user"><dt>Institution:</dt><dd>LaSEINE / CeNT. Kyushu Institute of Technology. </dd></dl>
<dl class="section user"><dt>Mail (after leaving Kyutech):</dt><dd><a href="#" onclick="location.href='mai'+'lto:'+'jua'+'n.'+'roj'+'as'+'@te'+'c.'+'ac.'+'cr'; return false;">juan.<span style="display: none;">.nosp@m.</span>roja<span style="display: none;">.nosp@m.</span>s@tec<span style="display: none;">.nosp@m.</span>.ac.<span style="display: none;">.nosp@m.</span>cr</a> </dd></dl>
<dl class="section user"><dt>Git repository:</dt><dd><a href="https://bitbucket.org/juanjorojash/cell_charger_discharger">https://bitbucket.org/juanjorojash/cell_charger_discharger</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a6f1efdf53830030b8d4b67843aad1870"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f1efdf53830030b8d4b67843aad1870">&#9670;&nbsp;</a></span>calculate_avg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_avg </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calculate the averages. </p>
<p>If <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> = <a class="el" href="charger__discharger_8h.html#a7194053a42881b1b4bc8546b4c8713e9" title="Counter value, needed to obtained one second between counts.">COUNTER</a></p>
<ul>
<li>Make <a class="el" href="charger__discharger_8h.html#a0799e1bdc59344ad781f8ed52b3d9189" title="Last one-second-average of i . Initialized as 0.">iavg</a> zero</li>
<li>Make <a class="el" href="charger__discharger_8h.html#aec6644dbb58ba751b340bd155b9e3cdc" title="Last one-second-average of v . Initialized as 0.">vavg</a> zero</li>
<li>Make <a class="el" href="charger__discharger_8h.html#a2d8afe51d9406df27f4388df51b61e38" title="Last one-second-average of t . Initialized as 0.">tavg</a> zero</li>
</ul>
<p>If <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> = 0</p>
<ul>
<li>Divide the value stored in <a class="el" href="charger__discharger_8h.html#a0799e1bdc59344ad781f8ed52b3d9189" title="Last one-second-average of i . Initialized as 0.">iavg</a> between COUNTER to obtain the average</li>
<li>This is equivalent to vacum / 1024 = vacum / 2^10</li>
<li>This is equivalent to tacum / 1024 = tacum / 2^10</li>
</ul>
<p>If <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> is not any of the previous cases then</p>
<ul>
<li>Accumulate <a class="el" href="charger__discharger_8h.html#a78f7a37dba921e0b0347b960fb40bc51" title="Last current ADC measurement.">i</a> in <a class="el" href="charger__discharger_8h.html#a0799e1bdc59344ad781f8ed52b3d9189" title="Last one-second-average of i . Initialized as 0.">iavg</a></li>
<li>Accumulate <a class="el" href="charger__discharger_8h.html#ac5f38113a34f9eab3e7782eade81d266" title="Last voltage ADC measurement.">v</a> in <a class="el" href="charger__discharger_8h.html#aec6644dbb58ba751b340bd155b9e3cdc" title="Last one-second-average of v . Initialized as 0.">vavg</a></li>
<li>Accumulate <a class="el" href="charger__discharger_8h.html#a3636f663c6b00463f1bad29dd9617997" title="Last temperature ADC measurement.">t</a> in <a class="el" href="charger__discharger_8h.html#a2d8afe51d9406df27f4388df51b61e38" title="Last one-second-average of t . Initialized as 0.">tavg</a> </li>
</ul>

</div>
</div>
<a id="a1db67160f1d6e9368e8c07df1c904eb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1db67160f1d6e9368e8c07df1c904eb4">&#9670;&nbsp;</a></span>cc_cv_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cc_cv_mode </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>current_voltage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>reference_voltage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>CC_mode_status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function switches between CC and CV mode. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_voltage</td><td>average of current voltage </td></tr>
    <tr><td class="paramname">referece_voltage</td><td>voltage setpoint </td></tr>
    <tr><td class="paramname">CC_mode_status</td><td>current condition of <a class="el" href="charger__discharger_8h.html#ad4bb67368b5b95e33bae6d43ef3174a8" title="CC / CV selector. CC:  cmode = 1 . CV:  cmode = 0">cmode</a> variable </td></tr>
  </table>
  </dd>
</dl>
<p>If the current voltage is bigger than the CV setpoint and the system is in CC mode, then:</p>
<ol>
<li>
<p class="startli">The integral acummulator is cleared</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The system is set in CV mode by clearing the <a class="el" href="charger__discharger_8h.html#ad4bb67368b5b95e33bae6d43ef3174a8" title="CC / CV selector. CC:  cmode = 1 . CV:  cmode = 0">cmode</a> variable</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The proportional constant divider is set to <a class="el" href="charger__discharger_8h.html#a31ae8362bae13f23cc6b521a7499a5ee" title="Proportional constant divider for CV mode.">CV_kp</a></p>
<p class="endli"></p>
</li>
<li>
The integral constant divider is set to <a class="el" href="charger__discharger_8h.html#a57181200f8247c552f8d9751003d77c6" title="Integral constant divider for CV mode.">CV_ki</a> </li>
</ol>

</div>
</div>
<a id="a3290085338ff7657c1ff25788d944727"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3290085338ff7657c1ff25788d944727">&#9670;&nbsp;</a></span>Cell_OFF()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Cell_OFF </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function deactivate all relays in the switcher board. </p>
<ul>
<li>Turn OFF cell #1 by calling <a class="el" href="charger__discharger_8h.html#a5d22532f168369b94569754b7f7ab68a" title="Turn off Cell #1.">CELL1_OFF</a></li>
<li>Turn OFF cell #2 by calling <a class="el" href="charger__discharger_8h.html#a90c4d70ae1140ba070196ee2849ebe6a" title="Turn off Cell #2.">CELL2_OFF</a></li>
<li>Turn OFF cell #3 by calling <a class="el" href="charger__discharger_8h.html#adc5d280d7d71f8a100ebf4cbc527ed32" title="Turn off Cell #3.">CELL3_OFF</a></li>
<li>Turn OFF cell #4 by calling <a class="el" href="charger__discharger_8h.html#a856ad78c73c34cd8f5d366bac3291b62" title="Turn off Cell #4.">CELL4_OFF</a> </li>
</ul>

</div>
</div>
<a id="a1d26bd6e1261ba0d776c492ad35593f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d26bd6e1261ba0d776c492ad35593f4">&#9670;&nbsp;</a></span>Cell_ON()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Cell_ON </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function activate the desired relay in the switcher board according to the value of <a class="el" href="charger__discharger_8h.html#a2f582152bcd11169abaab8dfb2e0ae2a" title="Cell counter from &#39;1&#39; to &#39;4&#39;. Initialized as &#39;1&#39;.">cell_count</a>. </p>
<p>If cell_count = '1'</p>
<ul>
<li>Turn ON cell #1 by calling <a class="el" href="charger__discharger_8h.html#a1e9c25e86679ce9f50b90bb24cb4cb0e" title="Turn on Cell #1.">CELL1_ON</a></li>
<li>Turn OFF cell #2 by calling <a class="el" href="charger__discharger_8h.html#a90c4d70ae1140ba070196ee2849ebe6a" title="Turn off Cell #2.">CELL2_OFF</a></li>
<li>Turn OFF cell #3 by calling <a class="el" href="charger__discharger_8h.html#adc5d280d7d71f8a100ebf4cbc527ed32" title="Turn off Cell #3.">CELL3_OFF</a></li>
<li>Turn OFF cell #4 by calling <a class="el" href="charger__discharger_8h.html#a856ad78c73c34cd8f5d366bac3291b62" title="Turn off Cell #4.">CELL4_OFF</a></li>
<li>Turn OFF cell #1 by calling <a class="el" href="charger__discharger_8h.html#a5d22532f168369b94569754b7f7ab68a" title="Turn off Cell #1.">CELL1_OFF</a></li>
<li>Turn ON cell #2 by calling <a class="el" href="charger__discharger_8h.html#a60e0c2428211d907b105684c342a328b" title="Turn on Cell #2.">CELL2_ON</a></li>
<li>Turn OFF cell #3 by calling <a class="el" href="charger__discharger_8h.html#adc5d280d7d71f8a100ebf4cbc527ed32" title="Turn off Cell #3.">CELL3_OFF</a></li>
<li>Turn OFF cell #4 by calling <a class="el" href="charger__discharger_8h.html#a856ad78c73c34cd8f5d366bac3291b62" title="Turn off Cell #4.">CELL4_OFF</a></li>
<li>Turn OFF cell #1 by calling <a class="el" href="charger__discharger_8h.html#a5d22532f168369b94569754b7f7ab68a" title="Turn off Cell #1.">CELL1_OFF</a></li>
<li>Turn OFF cell #2 by calling <a class="el" href="charger__discharger_8h.html#a90c4d70ae1140ba070196ee2849ebe6a" title="Turn off Cell #2.">CELL2_OFF</a></li>
<li>Turn ON cell #3 by calling <a class="el" href="charger__discharger_8h.html#a83bd4e8fdca326c574ea1a8d5681041a" title="Turn on Cell #3.">CELL3_ON</a></li>
<li>Turn OFF cell #4 by calling <a class="el" href="charger__discharger_8h.html#a856ad78c73c34cd8f5d366bac3291b62" title="Turn off Cell #4.">CELL4_OFF</a></li>
<li>Turn OFF cell #1 by calling <a class="el" href="charger__discharger_8h.html#a5d22532f168369b94569754b7f7ab68a" title="Turn off Cell #1.">CELL1_OFF</a></li>
<li>Turn OFF cell #2 by calling <a class="el" href="charger__discharger_8h.html#a90c4d70ae1140ba070196ee2849ebe6a" title="Turn off Cell #2.">CELL2_OFF</a></li>
<li>Turn OFF cell #3 by calling <a class="el" href="charger__discharger_8h.html#adc5d280d7d71f8a100ebf4cbc527ed32" title="Turn off Cell #3.">CELL3_OFF</a></li>
<li>Turn ON cell #4 by calling <a class="el" href="charger__discharger_8h.html#a7c6de72b4cd58814b85d05c7448fb498" title="Turn on Cell #4.">CELL4_ON</a> </li>
</ul>

</div>
</div>
<a id="a0c80a804f63cdf1b40bca055d0b2d77d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c80a804f63cdf1b40bca055d0b2d77d">&#9670;&nbsp;</a></span>control_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void control_loop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calls the PI control loop for current or voltage depending on the value of the <a class="el" href="charger__discharger_8h.html#ad4bb67368b5b95e33bae6d43ef3174a8" title="CC / CV selector. CC:  cmode = 1 . CV:  cmode = 0">cmode</a> variable. </p>
<p>If <a class="el" href="charger__discharger_8h.html#ad4bb67368b5b95e33bae6d43ef3174a8" title="CC / CV selector. CC:  cmode = 1 . CV:  cmode = 0">cmode</a> is cleared then</p>
<ul>
<li>The <a class="el" href="charger__discharger_8c.html#ac0a5face47787c24a8922e3a5b4274ee" title="This function defines the PI controller.">pid()</a> function is called with <code>feedback</code> = <a class="el" href="charger__discharger_8h.html#ac5f38113a34f9eab3e7782eade81d266" title="Last voltage ADC measurement.">v</a> and <code>setpoint</code> = <a class="el" href="charger__discharger_8h.html#a9677ac60c8e6bbdd674b48efcd82634e" title="Scaled voltage setpoint. Initialized as 0.">vref</a></li>
</ul>
<p>Else,</p>
<ul>
<li>The <a class="el" href="charger__discharger_8c.html#ac0a5face47787c24a8922e3a5b4274ee" title="This function defines the PI controller.">pid()</a> function is called with <code>feedback</code> = <a class="el" href="charger__discharger_8h.html#a78f7a37dba921e0b0347b960fb40bc51" title="Last current ADC measurement.">i</a> and <code>setpoint</code> = <a class="el" href="charger__discharger_8h.html#a18614df5d72e38b0006c070dcd4f8d86" title="Current setpoint. Initialized as 0.">iref</a></li>
</ul>
<p>The duty cycle is set by calling the <a class="el" href="charger__discharger_8c.html#a95853552054d1c99e8765eca54abb930" title="This function sets the desired duty cycle of the PWM.">set_DC()</a> function </p>

</div>
</div>
<a id="a9fcc321fc8a8e5fb1c8aeeae5da8daf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fcc321fc8a8e5fb1c8aeeae5da8daf1">&#9670;&nbsp;</a></span>display_value_s()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void display_value_s </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function convert a number to string and then send it using UART. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>integer to be send </td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>Define <code>buffer</code> to used it for store character storage</li>
<li>Convert <code>value</code> into a string and store it in <code>buffer</code> </li>
<li>Send <code>buffer</code> using <a class="el" href="charger__discharger_8c.html#ac27ccd7f2eb1f5e96bb091338acc1e7f" title="This function send a string using UART.">UART_send_string()</a> </li>
</ul>

</div>
</div>
<a id="a92a0c0757e4254434d1526372af3113d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92a0c0757e4254434d1526372af3113d">&#9670;&nbsp;</a></span>display_value_u()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void display_value_u </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function convert a number to string and then send it using UART. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">value</td><td>integer to be send </td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>Define <code>buffer</code> to used it for store character storage</li>
<li>Convert <code>value</code> into a string and store it in <code>buffer</code> </li>
<li>Send <code>buffer</code> using <a class="el" href="charger__discharger_8c.html#ac27ccd7f2eb1f5e96bb091338acc1e7f" title="This function send a string using UART.">UART_send_string()</a> </li>
</ul>

</div>
</div>
<a id="a25a40b6614565f755233080a384c35f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25a40b6614565f755233080a384c35f1">&#9670;&nbsp;</a></span>initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initialize </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to initialize all the PIC16F1787 registers. </p>
<p><b> GENERAL </b></p>
<ul>
<li>Clear WDT by calling <code>CLRWDT()</code> </li>
<li>Allow change of individual WPU</li>
</ul>
<p><b> SYSTEM CLOCK </b></p>
<ul>
<li>Set clock to 32MHz (PLL is enabled)</li>
<li>Clock determined by FOSC&lt;2:0&gt; in Configuration Words</li>
<li>Enable PLL.</li>
</ul>
<p><b> RELAY OUPUTS </b></p>
<ul>
<li>Set RC3 as output. Set for discharge</li>
<li>Deactivate weak pull up in RC3</li>
<li>Set RC4 as output. Set for charge</li>
<li>Deactivate weak pull up in RC4</li>
<li>Set RC5 as output. ON/OFF relay</li>
<li>Deactivate weak pull up in RC5</li>
</ul>
<p><b> CELL SWITCHER OUPUTS </b></p>
<ul>
<li>Set RB2 as output. Set for Cell #1</li>
<li>Set RB2 as digital</li>
<li>Deactivate weak pull up in RB2</li>
<li>Set RB3 as output. Set for Cell #2</li>
<li>Set RB3 as digital</li>
<li>Deactivate weak pull up in RB3</li>
<li>Set RB4 as output. Set for Cell #3</li>
<li>Set RB4 as digital</li>
<li>Deactivate weak pull up in RB4</li>
<li>Set RB5 as output. Set for Cell #4</li>
<li>Set RB5 as digital</li>
<li>Deactivate weak pull up in RB5</li>
</ul>
<p><b>TIMER1</b> </p>
<ul>
<li>Synchronize asynchronous clock input with system clock (FOSC)</li>
<li>Dedicated Timer1 oscillator circuit disabled</li>
<li>Enables Timer1</li>
<li>Timer1 counts regardless of Timer1 gate function</li>
<li>Timer1 clock source is instruction clock (FOSC/4)</li>
<li>1:1 Prescale value</li>
<li>Set Timer1 register to overflow in 0.97562 ms</li>
</ul>
<p><b> PROGRAMMABLE SWITCH MODE CONTROL (PSMC) </b></p>
<ul>
<li>Clear PSMC1 configuration</li>
<li>No modulation</li>
<li>Driven by 64MHz PLL system clock</li>
<li>Set period register to overflow in 8us (125kHz)</li>
<li>Rising event starts from the beginning, i.e duty cycle is in-phase with the period</li>
<li>Single PWM activated in PSMC1C (RC2)</li>
<li>PWM PSMC1 output is active-high (RC2)</li>
<li>PSMC output is active in PSMC1C (RC2)</li>
<li>Period event occurs when PSMC1TMR = PSMC1PR</li>
<li>Rising edge event occurs when PSMC1TMR = PSMC1PH</li>
<li>Falling edge event occurs when PSMC1TMR = PSMC1DC</li>
<li>PSMC1 module is enable</li>
<li>Disable buffer load</li>
<li>Disable dead band</li>
<li>Operating mode: Single PWM</li>
<li>Set RC2 as output. PWM output</li>
<li>Deactivate weak pull up in RC2</li>
</ul>
<p><b>ADC</b> </p>
<ul>
<li>Set RA3 as input. VREF+</li>
<li>Set RA3 as analog</li>
<li>Deactivate weak pull up in RA3</li>
<li>Set RB1 as input. Voltage sense</li>
<li>Set RB1 as analog</li>
<li>Deactivate weak pull up in RB1</li>
<li>Set RB0 as input. Current sense</li>
<li>Set RB0 as analog</li>
<li>Deactivate weak pull up in RB0</li>
<li>Set RA5 as input. Temperature sense</li>
<li>Set RA5 as analog</li>
<li>Deactivate weak pull up in RA5</li>
<li>12-bit result</li>
<li>Clock selected as FOSC/32</li>
<li>Negative reference connected to VSS</li>
<li>Positive reference connected to VREF+</li>
<li>2's compliment result</li>
<li>Negative differential input given by ADNREF</li>
<li>ADC is enabled</li>
</ul>
<p><b>UART</b> </p>
<ul>
<li>RC6 selected as TX</li>
<li>RC7 selected as RX</li>
<li>High baud rate set</li>
<li>16-bit timer set</li>
<li>Asynchronous serial</li>
<li>Enable serial port pins</li>
<li>Enable transmission</li>
<li>Enable reception</li>
<li>8-bit transmission selected</li>
<li>8-bit reception selected</li>
<li>Disable UART reception interrupts</li>
<li>Disable UART transmission interrupts</li>
</ul>
<p><b>FINAL</b> </p>
<ul>
<li>Call <a class="el" href="charger__discharger_8h.html#ae1cb4a0872e924cf862a97b33dd2edf0" title="Stop the converter.">STOP_CONVERTER()</a> macro </li>
</ul>

</div>
</div>
<a id="aaa547d1d7074b73a55b85640b558923b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa547d1d7074b73a55b85640b558923b">&#9670;&nbsp;</a></span>interrupt_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void interrupt_enable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function activate the UART reception interruption. </p>
<ul>
<li>Define the variable <code>clear_buffer</code>, used to empty the UART buffer</li>
<li>Clear the reception buffer and store it in <code>clear_buffer</code> </li>
<li>Enable UART reception interrupts</li>
<li>Disable UART transmission interrupts</li>
</ul>
<p>The timing counter <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> will be initialized to zero, to start a full control loop cycle </p>

</div>
</div>
<a id="a76c124e0fe411cb223495b945f9e7b6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76c124e0fe411cb223495b945f9e7b6d">&#9670;&nbsp;</a></span>log_control()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_control </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes care of calculating the average values printing the log data using the UART. </p>
<ul>
<li>Send a colons character</li>
<li>If <a class="el" href="charger__discharger_8h.html#af03cfc6ea64c1cf48f35ae59730afad6" title="Seconds counter, resetted after 59 seconds.">second</a> is smaller than 10 send a '0'</li>
<li>Send a comma character</li>
<li>Send a 'C'</li>
<li>Send a <a class="el" href="charger__discharger_8h.html#a2f582152bcd11169abaab8dfb2e0ae2a" title="Cell counter from &#39;1&#39; to &#39;4&#39;. Initialized as &#39;1&#39;.">cell_count</a> variable</li>
<li>Send a comma character</li>
<li>Send an 'S'</li>
<li>Send a comma character</li>
<li>Send a 'V'</li>
<li>Send a comma character</li>
<li>Send an 'I'</li>
<li>Send a comma character</li>
<li>Send a 'T'</li>
<li>Send a comma character</li>
<li>Send a 'Q'</li>
<li>Send a '&lt;'</li>
</ul>
<p>If <a class="el" href="charger__discharger_8h.html#a6d4067d47fba082577dc98dae5e53c48" title="Variable to indicate if the log is activated.">log_on</a> is cleared, call <a class="el" href="charger__discharger_8h.html#a59595b0c67a8bfb8dd65e914a18b83c7" title="Reset timers.">RESET_TIME()</a> </p>

</div>
</div>
<a id="ac0a5face47787c24a8922e3a5b4274ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0a5face47787c24a8922e3a5b4274ee">&#9670;&nbsp;</a></span>pid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pid </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>feedback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>setpoint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function defines the PI controller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">feedback</td><td>average of measured values for the control variable </td></tr>
    <tr><td class="paramname">setpoint</td><td>desire controlled output for the variable </td></tr>
  </table>
  </dd>
</dl>
<p>This function performs the folowing tasks:</p>
<ol>
<li>
<p class="startli">Calculate the error</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Make sure error is never above <a class="el" href="charger__discharger_8h.html#aadc49366a240cc84254d58cb455dee82" title="Maximum permisible error, useful to avoid ringing.">ERR_MAX</a></p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Make sure error is never below <a class="el" href="charger__discharger_8h.html#a5bcad3156af59109b8ac2c78c588885a" title="Minimum permisible error, useful to avoid ringing.">ERR_MIN</a></p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Calculate the proportional component of compensator</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Calculate the integral component of compensator usign <a class="el" href="charger__discharger_8h.html#a2ab083909f4f4cd7c27bff01f9865da8" title="Integral acumulator of PI compensator.">intacum</a> to accumulate over cycles</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Combine proportinal and integral parts</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Sum the result to the previous duty cycle stored in the <a class="el" href="charger__discharger_8h.html#adb07fc3f35b1ac3f277f3c4b80ce2269" title="Duty cycle.">dc</a> variable</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Make sure the duty cycle is never above <a class="el" href="charger__discharger_8h.html#a701d2222601b84faafa94cb1909df104" title="Maximum possible duty cycle, set around 0.8.">DC_MAX</a></p>
<p class="endli"></p>
</li>
<li>
Make sure duty cycle is never below <a class="el" href="charger__discharger_8h.html#a998e4507851dde706a60a5b475eb27ca" title="Minimum possible duty cycle, set around 0.1.">DC_MIN</a> </li>
</ol>

</div>
</div>
<a id="acb92cf488fc031fa581b9f7d2f90b438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb92cf488fc031fa581b9f7d2f90b438">&#9670;&nbsp;</a></span>scaling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scaling </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function takes care of scaling the average values to correspond with their real values. </p>
<p>This function performs the folowing tasks: </p>
<ol>
<li>
<p class="startli">Scale <a class="el" href="charger__discharger_8h.html#a0799e1bdc59344ad781f8ed52b3d9189" title="Last one-second-average of i . Initialized as 0.">iavg</a> according to the 12-bit ADC resolution (4096) and the sensitivity of the sensor (0.4 V/A).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Scale <a class="el" href="charger__discharger_8h.html#aec6644dbb58ba751b340bd155b9e3cdc" title="Last one-second-average of v . Initialized as 0.">vavg</a> according to the 12-bit ADC resolution (4096)</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Scale <a class="el" href="charger__discharger_8h.html#a2d8afe51d9406df27f4388df51b61e38" title="Last one-second-average of t . Initialized as 0.">tavg</a> according to the 12-bit ADC resolution (4096) and the sensitivity of the sensor ( (1866.3 - x)/1.169 )</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Perform the discrete integration of <a class="el" href="charger__discharger_8h.html#a0799e1bdc59344ad781f8ed52b3d9189" title="Last one-second-average of i . Initialized as 0.">iavg</a> over one second and accumulate in <a class="el" href="charger__discharger_8h.html#a26dd2ede681df7d784fa64efc10d350a" title="Integration of i . Initialized as 0.">qavg</a></p>
<p class="endli"></p>
</li>
<li>
If the chemistry is Ni-MH and <a class="el" href="charger__discharger_8h.html#aec6644dbb58ba751b340bd155b9e3cdc" title="Last one-second-average of v . Initialized as 0.">vavg</a> is bigger than <a class="el" href="charger__discharger_8h.html#aa45bd3ba8988708cb8dbf2d44220ba9f" title="Maximum recorded average voltage.">vmax</a> then set <a class="el" href="charger__discharger_8h.html#aa45bd3ba8988708cb8dbf2d44220ba9f" title="Maximum recorded average voltage.">vmax</a> equal to <a class="el" href="charger__discharger_8h.html#aec6644dbb58ba751b340bd155b9e3cdc" title="Last one-second-average of v . Initialized as 0.">vavg</a> </li>
</ol>

</div>
</div>
<a id="a95853552054d1c99e8765eca54abb930"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95853552054d1c99e8765eca54abb930">&#9670;&nbsp;</a></span>set_DC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_DC </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function sets the desired duty cycle of the PWM. </p>
<p>This function performs the folowing tasks: </p>
<ol>
<li>
<p class="startli">Load the duty cycle register of the PSMC with the <a class="el" href="charger__discharger_8h.html#adb07fc3f35b1ac3f277f3c4b80ce2269" title="Duty cycle.">dc</a> variable</p>
<p class="endli"></p>
</li>
<li>
Set the load register. This will load all the setting at once </li>
</ol>

</div>
</div>
<a id="ad7281e6b87164140f094392ac68ff1d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7281e6b87164140f094392ac68ff1d6">&#9670;&nbsp;</a></span>temp_protection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void temp_protection </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<ol type="1">
<li>Stop the converter by calling the <a class="el" href="charger__discharger_8h.html#ae1cb4a0872e924cf862a97b33dd2edf0" title="Stop the converter.">STOP_CONVERTER()</a> macro.</li>
<li>Go to the <a class="el" href="charger__discharger_8h.html#aa19be6305a5a4485e1e70de70ed7d677ae4634ae4352b512b38c5da9dc1610ca6" title="&quot;Stand by&quot; state, defined by function fSTANDBY()">STANDBY</a> state. </li>
</ol>

</div>
</div>
<a id="a4774aa6e41b08b4ff32010c008fa3a99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4774aa6e41b08b4ff32010c008fa3a99">&#9670;&nbsp;</a></span>timing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timing </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function control the timing. </p>
<p>If <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> is other than zero, then</p>
<ul>
<li>Make <a class="el" href="charger__discharger_8h.html#af6a39bfc7e1dc3b6f9c997c1c43fa996" title="Counter that should be cleared every second. Initialized as COUNTER.">count</a> equal to <a class="el" href="charger__discharger_8h.html#a7194053a42881b1b4bc8546b4c8713e9" title="Counter value, needed to obtained one second between counts.">COUNTER</a></li>
<li>If <a class="el" href="charger__discharger_8h.html#af03cfc6ea64c1cf48f35ae59730afad6" title="Seconds counter, resetted after 59 seconds.">second</a> is smaller than 59 then increase it</li>
<li>Else, make <a class="el" href="charger__discharger_8h.html#af03cfc6ea64c1cf48f35ae59730afad6" title="Seconds counter, resetted after 59 seconds.">second</a> zero and increase <a class="el" href="charger__discharger_8h.html#aa9bb52078cb5c647a0dfef243db183d6" title="Minutes counter, only manually reset.">minute</a></li>
</ul>
<p>Else,</p>
<ul>
<li>Decrease it </li>
</ul>

</div>
</div>
<a id="a29ad5228bebf7b764c5ee79400b208ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29ad5228bebf7b764c5ee79400b208ec">&#9670;&nbsp;</a></span>UART_get_char()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char UART_get_char </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function receive one byte of data from UART. </p>
<dl class="section return"><dt>Returns</dt><dd>RC1REG reception register </dd></dl>
<p>If there is error</p>
<ul>
<li>Clear the error</li>
<li>Restart</li>
</ul>
<p>Hold the program until the reception buffer is free</p>
<p>Receive the value and return it </p>

</div>
</div>
<a id="abf92d1a230db7234bdf5119716a0cf5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf92d1a230db7234bdf5119716a0cf5f">&#9670;&nbsp;</a></span>UART_send_char()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UART_send_char </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>bt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function send one byte of data to UART. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bt</td><td>character to be send </td></tr>
  </table>
  </dd>
</dl>
<ul>
<li>Hold the program until the transmission buffer is free</li>
<li>Load the transmission buffer with <code>bt</code> </li>
</ul>

</div>
</div>
<a id="ac27ccd7f2eb1f5e96bb091338acc1e7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac27ccd7f2eb1f5e96bb091338acc1e7f">&#9670;&nbsp;</a></span>UART_send_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UART_send_string </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>st_pt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function send a string using UART. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">st_pt</td><td>pointer to string to be send </td></tr>
  </table>
  </dd>
</dl>
<p>While there is a byte to send</p>
<ul>
<li>Send it using <a class="el" href="charger__discharger_8c.html#abf92d1a230db7234bdf5119716a0cf5f" title="This function send one byte of data to UART.">UART_send_char()</a> and then increase the pointer possition </li>
</ul>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
